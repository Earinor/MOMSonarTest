°
Mc:\Users\jafu\Source\Repos\NewRepo\MSMQTutorial\ClientApplication\App.xaml.cs
	namespace		 	
ClientApplication		
 
{

 
public 

partial 
class 
App 
: 
Application *
{ 
} 
} œ
Jc:\Users\jafu\Source\Repos\NewRepo\MSMQTutorial\ClientApplication\Logic.cs
	namespace 	
ClientApplication
 
{ 
public 

class 
Logic 
{ 
private		 
static		 
string		 
_path		 #
=		$ %
$str		& 4
;		4 5
private

 
static

 
string

 
_publicQueuePath

 .
=

/ 0
$str

1 9
;

9 :
private 
static 
string 
description )
=* +
$str, G
;G H
private 
static 
string 
pubDesc %
=& '
$str( D
;D E
private 
string 
	_username  
;  !
private 
MessageQueue 
_publicQueue )
;) *
private 
MessageQueue 
_privateQueue *
;* +
public 
Logic 
( 
string 
username $
)$ %
{ 	
	_username 
= 
username  
;  !
string 

publicPath 
= 
_path  %
+& '
_publicQueuePath( 8
;8 9
if 
( 
MessageQueue 
. 
Exists #
(# $

publicPath$ .
). /
)/ 0
{ 
_publicQueue 
= 
new "
MessageQueue# /
(/ 0

publicPath0 :
): ;
;; <
_publicQueue 
. 
Label "
=# $
description% 0
;0 1
} 
else   
{!! 
MessageQueue"" 
."" 
Create"" #
(""# $

publicPath""$ .
)"". /
;""/ 0
_publicQueue## 
=## 
new## "
MessageQueue### /
(##/ 0

publicPath##0 :
)##: ;
;##; <
_publicQueue$$ 
.$$ 
Label$$ "
=$$# $
description$$% 0
;$$0 1
}%% 
string)) 
privatePath)) 
=))  
_path))! &
+))' (
username))) 1
;))1 2
if++ 
(++ 
MessageQueue++ 
.++ 
Exists++ #
(++# $
privatePath++$ /
)++/ 0
)++0 1
{,, 
_privateQueue-- 
=-- 
new--  #
MessageQueue--$ 0
(--0 1
privatePath--1 <
)--< =
;--= >
_privateQueue.. 
... 
Label.. #
=..$ %
pubDesc..& -
;..- .
}// 
else00 
{11 
MessageQueue22 
.22 
Create22 #
(22# $
privatePath22$ /
)22/ 0
;220 1
_privateQueue33 
=33 
new33  #
MessageQueue33$ 0
(330 1
privatePath331 <
)33< =
;33= >
_privateQueue44 
.44 
Label44 #
=44$ %
pubDesc44& -
;44- .
}55 
}66 	
public88 
void88 
SendMessage88 
(88  
MessageObject88  -
msg88. 1
)881 2
{99 	
_publicQueue:: 
.:: 
Send:: 
(:: 
msg:: !
)::! "
;::" #
};; 	
}== 
}>> £\
Tc:\Users\jafu\Source\Repos\NewRepo\MSMQTutorial\ClientApplication\MainWindow.xaml.cs
	namespace 	
ClientApplication
 
{ 
public 

partial 
class 

MainWindow #
:$ %
Window& ,
{ 
private 
Logic 
_logic 
; 
private 
string 
	_username  
;  !
private 
static 
string 
_path #
=$ %
$str& 4
;4 5
public 

MainWindow 
( 
) 
{ 	
InitializeComponent 
(  
)  !
;! "

tbUsername 
. 
Text 
= 
$str '
;' (
btSend 
. 
	IsEnabled 
= 
false $
;$ %
tbInput 
. 
	IsEnabled 
= 
false  %
;% &
} 	
private 
void 
Init 
( 
) 
{ 	
cbMode 
. 
Items 
. 
Add 
( 
Command $
.$ %
Shout% *
)* +
;+ ,
cbMode 
. 
Items 
. 
Add 
( 
Command $
.$ %
Whisper% ,
), -
;- .
cbMode 
. 
Items 
. 
Add 
( 
Command $
.$ %
Users% *
)* +
;+ ,
cbMode"" 
."" 
SelectedIndex""  
=""! "
$num""# $
;""$ %
_logic%% 
=%% 
new%% 
Logic%% 
(%% 

tbUsername%% )
.%%) *
Text%%* .
)%%. /
;%%/ 0
StartListening(( 
((( 
_path((  
+((! "
	_username((# ,
)((, -
;((- .
}** 	
private11 
void11 
StartListening11 #
(11# $
string11$ *
	queuePath11+ 4
)114 5
{22 	
MessageQueue44 
privateQueue44 %
=44& '
new44( +
MessageQueue44, 8
(448 9
	queuePath449 B
)44B C
;44C D
privateQueue77 
.77 
	Formatter77 "
=77# $
new77% (
XmlMessageFormatter77) <
(77< =
new77= @
Type77A E
[77E F
]77F G
{88 
typeof88 
(88 
MessageObject88 %
)88% &
}88& '
)88' (
;88( )
privateQueue;; 
.;; 
ReceiveCompleted;; )
+=;;* ,
new<< (
ReceiveCompletedEventHandler<< 0
(<<0 1
MsgReceiveCompleted<<1 D
)<<D E
;<<E F
privateQueue?? 
.?? 
BeginReceive?? %
(??% &
)??& '
;??' (
}@@ 	
privateGG 
voidGG 

AddMessageGG 
(GG  
MessageObjectGG  -
msgGG. 1
,GG1 2
boolGG3 7
sendGG8 <
=GG= >
falseGG? D
)GGD E
{HH 	
stringII 
lineII 
=II 
$strII 
;II 
ifKK 
(KK 
msgKK 
.KK 
CommandKK 
==KK 
CommandKK &
.KK& '
SystemKK' -
)KK- .
{LL 
lineMM 
=MM 
$strMM !
+MM" #
msgMM$ '
.MM' (
MessageMM( /
;MM/ 0
}NN 
elseOO 
{PP 
stringQQ 
usertagQQ 
=QQ  
$strQQ! #
;QQ# $
ifSS 
(SS 
sendSS 
)SS 
{TT 
ifUU 
(UU 
msgUU 
.UU 
CommandUU #
==UU$ &
CommandUU' .
.UU. /
WhisperUU/ 6
&&UU7 9
!UU: ;
stringUU; A
.UUA B
IsNullOrEmptyUUB O
(UUO P
msgUUP S
.UUS T

ToUsernameUUT ^
)UU^ _
)UU_ `
{VV 
usertagWW 
=WW  !
$strWW" (
+WW) *
msgWW+ .
.WW. /

ToUsernameWW/ 9
;WW9 :
}XX 
}YY 
elseZZ 
{[[ 
if\\ 
(\\ 
msg\\ 
.\\ 
Command\\ #
==\\$ &
Command\\' .
.\\. /
Shout\\/ 4
||\\5 7
msg\\8 ;
.\\; <
Command\\< C
==\\D F
Command\\G N
.\\N O
Whisper\\O V
)\\V W
{]] 
usertag^^ 
=^^  !
$str^^" *
+^^+ ,
msg^^- 0
.^^0 1
Username^^1 9
;^^9 :
}__ 
}`` 
linecc 
=cc 
$strcc 
+cc 
msgcc  
.cc  !
Commandcc! (
+cc) *
usertagcc+ 2
+cc3 4
$strcc5 9
+cc: ;
msgcc< ?
.cc? @
Messagecc@ G
;ccG H
}dd 
lineee 
+=ee 
$stree 
;ee 
tbChatboardff 
.ff 
Textff 
+=ff 
lineff  $
;ff$ %
}gg 	
privatejj 
voidjj 
SetUsersjj 
(jj 
stringjj $
	usernamesjj% .
)jj. /
{kk 	
cbUserll 
.ll 
Itemsll 
.ll 
Clearll 
(ll 
)ll  
;ll  !
cbUsermm 
.mm 
Itemsmm 
.mm 
Addmm 
(mm 
$strmm 
)mm  
;mm  !
stringnn 
[nn 
]nn 
usersnn 
=nn 
	usernamesnn &
.nn& '
Splitnn' ,
(nn, -
$charnn- 0
)nn0 1
;nn1 2
foreachoo 
(oo 
varoo 
useroo 
inoo  
usersoo! &
)oo& '
{pp 
cbUserqq 
.qq 
Itemsqq 
.qq 
Addqq  
(qq  !
userqq! %
)qq% &
;qq& '
}rr 
cbUserss 
.ss 
SelectedIndexss  
=ss! "
$numss# $
;ss$ %
}tt 	
privatevv 
voidvv 
btUsername_Clickvv %
(vv% &
objectvv& ,
sendervv- 3
,vv3 4
RoutedEventArgsvv5 D
evvE F
)vvF G
{ww 	
	_usernamexx 
=xx 

tbUsernamexx "
.xx" #
Textxx# '
;xx' (

tbUsernamezz 
.zz 
	IsEnabledzz  
=zz! "
falsezz# (
;zz( )

btUsername{{ 
.{{ 
	IsEnabled{{  
={{! "
false{{# (
;{{( )
tbInput|| 
.|| 
	IsEnabled|| 
=|| 
true||  $
;||$ %
btSend}} 
.}} 
	IsEnabled}} 
=}} 
true}} #
;}}# $
Init~~ 
(~~ 
)~~ 
;~~ 
} 	
private
 
void
 
btSend_Click
 !
(
! "
object
" (
sender
) /
,
/ 0
RoutedEventArgs
1 @
e
A B
)
B C
{
‚‚ 	
MessageObject
„„ 
mo
„„ 
=
„„ 
new
„„ "
MessageObject
„„# 0
{
…… 
Command
†† 
=
†† 
(
†† 
Command
†† "
)
††" #
cbMode
††# )
.
††) *
SelectedItem
††* 6
,
††6 7
Message
‡‡ 
=
‡‡ 
tbInput
‡‡ !
.
‡‡! "
Text
‡‡" &
,
‡‡& '

ToUsername
ˆˆ 
=
ˆˆ 
cbUser
ˆˆ #
.
ˆˆ# $
SelectedItem
ˆˆ$ 0
?
ˆˆ0 1
.
ˆˆ1 2
ToString
ˆˆ2 :
(
ˆˆ: ;
)
ˆˆ; <
,
ˆˆ< =
Username
‰‰ 
=
‰‰ 

tbUsername
‰‰ %
.
‰‰% &
Text
‰‰& *
}
ŠŠ 
;
ŠŠ 

AddMessage
 
(
 
mo
 
,
 
true
 
)
  
;
  !
_logic
 
.
 
SendMessage
 
(
 
mo
 !
)
! "
;
" #
tbInput
““ 
.
““ 
Focus
““ 
(
““ 
)
““ 
;
““ 
tbInput
–– 
.
–– 
Text
–– 
=
–– 
$str
–– 
;
–– 
scChatboard
™™ 
.
™™ 
ScrollToBottom
™™ &
(
™™& '
)
™™' (
;
™™( )
}
šš 	
public
¡¡ 
void
¡¡ !
MsgReceiveCompleted
¡¡ '
(
¡¡' (
object
¡¡( .
source
¡¡/ 5
,
¡¡5 6'
ReceiveCompletedEventArgs
¡¡7 P
asyncResult
¡¡Q \
)
¡¡\ ]
{
¢¢ 	
try
££ 
{
¤¤ 
MessageQueue
¦¦ 
mq
¦¦ 
=
¦¦  !
(
¦¦" #
MessageQueue
¦¦# /
)
¦¦/ 0
source
¦¦0 6
;
¦¦6 7
Message
©© 
m
©© 
=
©© 
mq
©© 
.
©© 

EndReceive
©© )
(
©©) *
asyncResult
©©* 5
.
©©5 6
AsyncResult
©©6 A
)
©©A B
;
©©B C
MessageObject
«« 
mo
««  
=
««! "
m
««# $
.
««$ %
Body
««% )
as
««* ,
MessageObject
««- :
;
««: ;
if
­­ 
(
­­ 
mo
­­ 
.
­­ 
Command
­­ 
==
­­ !
Command
­­" )
.
­­) *
Users
­­* /
)
­­/ 0
{
®® 

Dispatcher
¯¯ 
.
¯¯ 
Invoke
¯¯ %
(
¯¯% &
(
¯¯& '
)
¯¯' (
=>
¯¯) +
SetUsers
¯¯, 4
(
¯¯4 5
mo
¯¯5 7
.
¯¯7 8
Message
¯¯8 ?
)
¯¯? @
)
¯¯@ A
;
¯¯A B
}
°° 
else
±± 
{
²² 

Dispatcher
³³ 
.
³³ 
Invoke
³³ %
(
³³% &
(
³³& '
)
³³' (
=>
³³) +

AddMessage
³³, 6
(
³³6 7
mo
³³7 9
)
³³9 :
)
³³: ;
;
³³; <
}
´´ 
mq
·· 
.
·· 
BeginReceive
·· 
(
··  
)
··  !
;
··! "
}
¸¸ 
catch
¹¹ 
(
¹¹ #
MessageQueueException
¹¹ (
mqe
¹¹) ,
)
¹¹, -
{
ºº 
MessageObject
¼¼ 
mo
¼¼  
=
¼¼! "
new
¼¼# &
MessageObject
¼¼' 4
{
½½ 
Command
¾¾ 
=
¾¾ 
Command
¾¾ %
.
¾¾% &
System
¾¾& ,
,
¾¾, -
Message
¿¿ 
=
¿¿ 
mqe
¿¿ !
.
¿¿! "
Message
¿¿" )
}
ÀÀ 
;
ÀÀ 

Dispatcher
ÁÁ 
.
ÁÁ 
Invoke
ÁÁ !
(
ÁÁ! "
(
ÁÁ" #
)
ÁÁ# $
=>
ÁÁ% '

AddMessage
ÁÁ( 2
(
ÁÁ2 3
mo
ÁÁ3 5
)
ÁÁ5 6
)
ÁÁ6 7
;
ÁÁ7 8
}
ÂÂ 
return
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
}
ÆÆ 
}ÇÇ £
\c:\Users\jafu\Source\Repos\NewRepo\MSMQTutorial\ClientApplication\Properties\AssemblyInfo.cs
[

 
assembly

 	
:

	 

AssemblyTitle

 
(

 
$str

 ,
)

, -
]

- .
[ 
assembly 	
:	 

AssemblyDescription 
( 
$str !
)! "
]" #
[ 
assembly 	
:	 
!
AssemblyConfiguration  
(  !
$str! #
)# $
]$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str .
). /
]/ 0
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
["" 
assembly"" 	
:""	 

	ThemeInfo"" 
("" &
ResourceDictionaryLocation## 
.## 
None## #
,### $&
ResourceDictionaryLocation&& 
.&& 
SourceAssembly&& -
))) 
])) 
[66 
assembly66 	
:66	 

AssemblyVersion66 
(66 
$str66 $
)66$ %
]66% &
[77 
assembly77 	
:77	 

AssemblyFileVersion77 
(77 
$str77 (
)77( )
]77) *